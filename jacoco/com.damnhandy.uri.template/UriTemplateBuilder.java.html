<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>UriTemplateBuilder.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="right"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Handy URI Templates</a> &gt; <a href="index.html" class="el_package">com.damnhandy.uri.template</a> &gt; <span class="el_source">UriTemplateBuilder.java</span></div><h1>UriTemplateBuilder.java</h1><pre class="source lang-java linenums">/*
 *
 *
 */
package com.damnhandy.uri.template;

import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.LinkedList;
import java.util.Map;

import com.damnhandy.uri.template.impl.Modifier;
import com.damnhandy.uri.template.impl.Operator;
import com.damnhandy.uri.template.impl.UriTemplateParser;
import com.damnhandy.uri.template.impl.VarSpec;

/**
 * &lt;p&gt;
 * A utility class used for programatically generating a {@link UriTemplate}.
 * The class can be used as follows:
 * &lt;/p&gt;
 * &lt;pre&gt;
 * UriTemplate template = UriTemplate.buildFromTemplate(&quot;http://example.com&quot;)
 *                                   .literal(&quot;/foo&quot;)
 *                                   .path(var(&quot;thing1&quot;), var(&quot;explodedThing&quot;, true))
 *                                   .fragment(var(&quot;prefix&quot;, 2))
 *                                   .build();
 * &lt;/pre&gt;
 * &lt;p&gt;
 * This code will return a {@link UriTemplate} with the following value:
 * &lt;/p&gt;
 * &lt;pre&gt;
 * http://example.com/foo{/thing1,explodedThing*}{#prefix:2}
 * &lt;/pre&gt;
 * 
 * @author &lt;a href=&quot;ryan@damnhandy.com&quot;&gt;Ryan J. McDonough&lt;/a&gt;
 * @version $Revision: 1.1 $
 */
public final class UriTemplateBuilder
{

   /**
    * The URI expression
    */
<span class="fc" id="L45">   private LinkedList&lt;UriTemplateComponent&gt; components = new LinkedList&lt;UriTemplateComponent&gt;();</span>

   /**
    *
    */
<span class="fc" id="L50">   private DateFormat defaultDateFormat = null;</span>

   /**
    *
    */
<span class="fc" id="L55">   private Map&lt;String, Object&gt; values = null;</span>

   /**
    *
    * Create a new UriTemplateBuilder.
    *
    * @param templateString
    */
   UriTemplateBuilder(String templateString) throws MalformedUriTemplateException
<span class="fc" id="L64">   {</span>
<span class="fc" id="L65">      this.components = new UriTemplateParser().scan(templateString);</span>
<span class="fc" id="L66">   }</span>
   
   
   

   /**
    *
    * Create a new UriTemplateBuilder.
    *
    * @param template
    */
   UriTemplateBuilder(UriTemplate template) throws MalformedUriTemplateException
   {
<span class="fc" id="L79">      this(template.getTemplate());</span>
<span class="fc" id="L80">      this.values = template.getValues();</span>
<span class="fc" id="L81">      this.defaultDateFormat = template.defaultDateFormat;</span>
<span class="fc" id="L82">   }</span>



   /**
   *
   * @param dateFormatString
   * @return
   * @since 2.0
   */
   public UriTemplateBuilder withDefaultDateFormat(String dateFormatString)
   {
<span class="fc" id="L94">      return this.withDefaultDateFormat(new SimpleDateFormat(dateFormatString));</span>
   }

   /**
    *
    * @param dateFormat
    * @return
    * @since 2.0
    */
   public UriTemplateBuilder withDefaultDateFormat(DateFormat dateFormat)
   {
<span class="fc" id="L105">      defaultDateFormat = dateFormat;</span>
<span class="fc" id="L106">      return this;</span>
   }

   
   private void addComponent(UriTemplateComponent component)
   {
<span class="fc" id="L112">      this.components.add(component);</span>
<span class="fc" id="L113">   }</span>

   /**
    * Appends a {@link Literal} value to the {@link UriTemplate}. The following 
    * code:
    * 
    * &lt;pre&gt;
    * UriTemplate template = UriTemplate.buildFromTemplate(&quot;http://example.com&quot;)
    *                                   .literal(&quot;/foo&quot;)
    *                                   .build();
    * &lt;/pre&gt;
    * 
    * Will generate the following template:
    * 
    * &lt;pre&gt;
    * http://example.com/foo
    * &lt;/pre&gt;
    * 
    * Note that this particular example has no expressions, so it's not a valid URI template.
    * @param string
    * @return
    */
   public UriTemplateBuilder literal(String string)
   {
<span class="fc bfc" id="L137" title="All 2 branches covered.">      if (string == null)</span>
      {
<span class="fc" id="L139">         return this;</span>
      }
<span class="fc" id="L141">      addComponent(new Literal(string, 0));</span>
<span class="fc" id="L142">      return this;</span>
   }

    /**
     *
     * @param varSpec
     * @return
     */
   private static VarSpec[] toVarSpec(String...varSpec)
   {
<span class="fc" id="L152">      VarSpec[] vars = new VarSpec[varSpec.length];</span>
<span class="fc bfc" id="L153" title="All 2 branches covered.">      for(int i = 0; i &lt; varSpec.length; i++)</span>
      {
<span class="fc" id="L155">         vars[i] = var(varSpec[i]);</span>
      }
<span class="fc" id="L157">      return vars;</span>
   }

    /**
     * Appends a template expression using no operator. The following
     * code:
     * &lt;pre&gt;
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
     *                   .simple(&quot;foo&quot;)
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com/{foo}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder simple(String...var)
   {
<span class="fc" id="L178">      simple(toVarSpec(var));</span>
<span class="fc" id="L179">      return this;</span>
   }

    /**
     * Appends a template expression using no operator but with an optional
     * modifier. The following code:
     * &lt;pre&gt;
     * import static com.damnhandy.uri.template.UriTemplateBuilder.var;
     *
     * ...
     *
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
     *                   .simple(var(&quot;foo&quot;,true))
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com/{foo*}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder simple(VarSpec...var)
   {
<span class="fc" id="L204">      addComponent(Expression.simple(var).build());</span>
<span class="fc" id="L205">      return this;</span>
   }
   /**
    * Appends a template expression using the reserved operator (+). The following 
    * code:
    * &lt;pre&gt;
    * UriTemplate template = 
    *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
    *                   .reserved(&quot;foo&quot;)
    *                   .build();
    * &lt;/pre&gt;
    * Will generate the following URI Template string:
    * &lt;pre&gt;
    * http://example.com/{+foo}
    * &lt;/pre&gt;
    * @param var
    * @return
    */
   public UriTemplateBuilder reserved(String...var)
   {
<span class="fc" id="L225">      reserved(toVarSpec(var));</span>
<span class="fc" id="L226">      return this;</span>
   }

   /**
    * Appends a template expression using the reserved operator (+) along
    * with an optional modifier. The following code:
    * &lt;pre&gt;
    * import static com.damnhandy.uri.template.UriTemplateBuilder.var;
    *
    * ...
    *
    * UriTemplate template =
    *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
    *                   .reserved(var(&quot;foo&quot;,1))
    *                   .build();
    * &lt;/pre&gt;
    * Will generate the following URI Template string:
    * &lt;pre&gt;
    * http://example.com/{+foo:1}
    * &lt;/pre&gt;
    * @param var
    * @return
    */
   public UriTemplateBuilder reserved(VarSpec...var)
   {
<span class="fc" id="L251">      addComponent(Expression.reserved(var).build());</span>
<span class="fc" id="L252">      return this;</span>
   }
   
   /**
    * Appends a template expression using the fragment operator (#). The 
    * following code:
    * &lt;pre&gt;
    * UriTemplate template = 
    *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
    *                   .fragement(&quot;foo&quot;)
    *                   .build();
    * &lt;/pre&gt;
    * Will generate the following URI Template string:
    * &lt;pre&gt;
    * http://example.com/{#foo}
    * &lt;/pre&gt;
    * 
    * @param var
    * @throws UriTemplateBuilderException if you attempt to add more than one fragment expression, a UriTemplateBuilderException will be raised
    * @return
    */
   public UriTemplateBuilder fragment(String...var) throws UriTemplateBuilderException
   {
<span class="fc" id="L275">      fragment(toVarSpec(var));</span>
<span class="fc" id="L276">      return this;</span>
   }

   /**
    * Appends a template expression using the fragment operator (#) with a
    * modifier. The following code:
    * &lt;pre&gt;
    * import static com.damnhandy.uri.template.UriTemplateBuilder.var;
    *
    * ...
    *
    * UriTemplate template = 
    *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
    *                   .fragement(var(&quot;foo&quot;, 1))
    *                   .build();
    * &lt;/pre&gt;
    * Will generate the following URI Template string:
    * &lt;pre&gt;
    * http://example.com/{#foo:1}
    * &lt;/pre&gt;
    * 
    * @param var
    * @throws UriTemplateBuilderException if you attempt to add more than one fragment expression, a UriTemplateBuilderException will be raised
    * @return
    */
   public UriTemplateBuilder fragment(VarSpec...var) throws UriTemplateBuilderException
   {
<span class="fc bfc" id="L303" title="All 2 branches covered.">      if(hasExpressionWithOperator(Operator.FRAGMENT))</span>
      {
<span class="fc" id="L305">         throw new UriTemplateBuilderException(&quot;The template already has a fragment expression and this would not result in a valid URI&quot;);</span>
      }
<span class="fc" id="L307">      addComponent(Expression.fragment(var).build());</span>
<span class="fc" id="L308">      return this;</span>
   }

    /**
     * Scans the components for an expression with the specified operator.
     * @param op
     * @return
     */
   private boolean hasExpressionWithOperator(Operator op)
   {
<span class="fc bfc" id="L318" title="All 2 branches covered.">      for(UriTemplateComponent c : components)</span>
      {
<span class="fc bfc" id="L320" title="All 2 branches covered.">         if(Expression.class.isInstance(c))</span>
         {
<span class="fc" id="L322">            Expression e = (Expression) c;</span>
<span class="fc bfc" id="L323" title="All 2 branches covered.">            if(e.getOperator() == op)</span>
            {
<span class="fc" id="L325">               return true;</span>
            }
         }
<span class="fc" id="L328">      }</span>
<span class="fc" id="L329">      return false;</span>
   }
    /**
     * Appends a template expression using the label (.) operator. The following
     * code:
     * &lt;pre&gt;
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
     *                   .label(&quot;foo&quot;)
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com/{.foo}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder label(String...var)
   {
<span class="fc" id="L349">      label(toVarSpec(var));</span>
<span class="fc" id="L350">      return this;</span>
   }

    /**
     * Appends a template expression using the label (.) operator and modifier.
     * The following code:
     * &lt;pre&gt;
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
     *                   .label(var(&quot;foo&quot;, true))
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com/{.foo*}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder label(VarSpec...var)
   {
<span class="fc" id="L371">      addComponent(Expression.label(var).build());</span>
<span class="fc" id="L372">      return this;</span>
   }
    /**
     * Appends a template expression using the matrix (;) operator. The following
     * code:
     * &lt;pre&gt;
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
     *                   .matrix(&quot;foo&quot;)
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com/{;foo}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder matrix(String...var)
   {
<span class="fc" id="L392">      matrix(toVarSpec(var));</span>
<span class="fc" id="L393">      return this;</span>
   }
    /**
     * Appends a template expression using the matrix (;) operator and modifier.
     * The following code:
     * &lt;pre&gt;
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
     *                   .matrix(var(&quot;foo&quot;, true))
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com/{;foo*}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder matrix(VarSpec...var)
   {
<span class="fc" id="L413">      addComponent(Expression.matrix(var).build());</span>
<span class="fc" id="L414">      return this;</span>
   }

    /**
     * Appends a template expression using the path (/) operator. The following
     * code:
     * &lt;pre&gt;
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com&quot;)
     *                   .path(&quot;foo&quot;)
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com{/foo}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder path(String...var)
   {
<span class="fc" id="L435">      path(toVarSpec(var));</span>
<span class="fc" id="L436">      return this;</span>
   }

    /**
     * Appends a template expression using the path (/) operator and modifier.
     * The following code:
     * &lt;pre&gt;
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com&quot;)
     *                   .path(var(&quot;foo&quot;, 1))
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com{/foo:1}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder path(VarSpec...var)
   {
<span class="fc" id="L457">      addComponent(Expression.path(var).build());</span>
<span class="fc" id="L458">      return this;</span>
   }

    /**
     * Appends a template expression using the query (?) operator. The following
     * code:
     * &lt;pre&gt;
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
     *                   .query(&quot;foo&quot;)
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com/{?foo}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder query(String...var)
   {
<span class="fc" id="L479">      query(toVarSpec(var));</span>
<span class="fc" id="L480">      return this;</span>
   }

    /**
     * Appends a template expression using the query (?) operator and
     * and optional modifier. The following
     * code:
     * &lt;pre&gt;
     * import static com.damnhandy.uri.template.UriTemplateBuilder.var;
     *
     * ...
     *
     * UriTemplate template =
     *        UriTemplate.buildFromTemplate(&quot;http://example.com/&quot;)
     *                   .query(var(&quot;foo&quot;,1))
     *                   .build();
     * &lt;/pre&gt;
     * Will generate the following URI Template string:
     * &lt;pre&gt;
     * http://example.com/{?foo:1}
     * &lt;/pre&gt;
     * @param var
     * @return
     */
   public UriTemplateBuilder query(VarSpec...var)
   {
<span class="fc" id="L506">      addComponent(Expression.query(var).build());</span>
<span class="fc" id="L507">      return this;</span>
   }
   
   

   /**
    * &lt;p&gt;
    * Generates a {@link UriTemplate} instance from the builder.
    * &lt;/p&gt;
    *
    * @return
    * @since 2.0
    */
   public UriTemplate build() throws MalformedUriTemplateException
   {
<span class="fc" id="L522">      UriTemplate template = new UriTemplate(this.components);</span>
<span class="fc bfc" id="L523" title="All 2 branches covered.">      if(this.values != null)</span>
      {
<span class="fc" id="L525">         template.set(values);</span>
      }
      
<span class="fc bfc" id="L528" title="All 2 branches covered.">      if (defaultDateFormat != null)</span>
      {
<span class="fc" id="L530">         template.defaultDateFormat = defaultDateFormat;</span>
      }
<span class="fc" id="L532">      return template;</span>
   }
   
   /**
    * Adds a variable name to the expression.
    *
    * &lt;pre&gt;
    * var(&quot;foo&quot;);
    * &lt;/pre&gt;
    *
    * Will yield the following expression:
    * &lt;pre&gt;
    * {foo}
    * &lt;/pre&gt;
    *
    * @param varName
    * @return
    */
   public static VarSpec var(String varName)
   {
<span class="fc" id="L552">      return var(varName, Modifier.NONE, null);</span>
   }

   /**
    * Adds a variable name to the expression with an explode modifier.
    *
    * &lt;pre&gt;
    * var(&quot;foo&quot;,true);
    * &lt;/pre&gt;
    *
    * Will yield the following expression:
    * &lt;pre&gt;
    * {foo*}
    * &lt;/pre&gt;
    *
    * @param varName
    * @param explode
    * @return
    */
   public static VarSpec var(String varName, boolean explode)
   {
<span class="pc bpc" id="L573" title="1 of 2 branches missed.">      if (explode)</span>
      {
<span class="fc" id="L575">         return var(varName, Modifier.EXPLODE, null);</span>
      }
<span class="nc" id="L577">      return var(varName, Modifier.NONE, null);</span>
   }

   /**
    * Adds a variable name to the expression with a prefix modifier.
    *
    * &lt;pre&gt;
    * var(&quot;foo&quot;,2);
    * &lt;/pre&gt;
    *
    * Will yield the following expression:
    * &lt;pre&gt;
    * {foo:2}
    * &lt;/pre&gt;
    * @param varName
    * @param prefix
    * @return
    */
   public static VarSpec var(String varName, int prefix)
   {
<span class="fc" id="L597">      return var(varName, Modifier.PREFIX, prefix);</span>
   }

   /**
    *
    *
    * @param varName
    * @param modifier
    * @param position
    * @return
    */
   private static VarSpec var(String varName, Modifier modifier, Integer position)
   {
<span class="fc" id="L610">      return new VarSpec(varName, modifier, position);</span>
   }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.6.3.201306030806</span></div></body></html>